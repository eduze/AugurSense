<div class="col-md-8 offset-md-2 col-sm-10 offset-sm-1 mt-3">

  <mat-card>
    <mat-card-title>Zone Map</mat-card-title>
    <mat-card-subtitle>
      From
      <p-calendar [showTime]="true" [(ngModel)]="fromDate"></p-calendar>
      to
      <p-calendar [showTime]="true" [(ngModel)]="toDate"></p-calendar>
    </mat-card-subtitle>

    <mat-card-content>
      <div class="row" *ngIf="globalMap">
        <div class="col-md-12 col-sm-12 col-xs-12">

          <svg x="0" y="0" width="100%" height="500">
            <g height="100%" width="100%">
              <image [attr.xlink:href]="globalMap.image" x="0" y="0" (click)="backgroundClicked();"></image>
              <g *ngFor="let poly of polygons; let i = index">
                <polygon class="zone" [attr.points]="poly.polygon" (click)="zoneClicked(i);"
                         [class.zone-selected]="i === selectedZoneIndex"></polygon>

                <text [attr.x]="poly.midX" [attr.y]="poly.midY-30" fill="yellow" font-size="15" text-anchor="middle">
                  {{ poly.zone.zoneName }}
                </text>

                <text [attr.x]="poly.midX" [attr.y]="poly.midY" fill="yellow" font-size="15" text-anchor="middle"
                      *ngIf="poly.zoneStatistic != null && (selectedZoneIndex < 0 || selectedZoneIndex == i)">
                  {{ poly.zoneStatistic.averagePersonCount | number : '1.2-2'}} People
                </text>

                <g *ngIf="selectedZoneIndex == i && poly.zoneStatistic != null">
                  <text [attr.x]="neighbour.midX" fill="red" [attr.y]="neighbour.midY - 10"
                        *ngFor="let neighbour of poly.outgoingMap" font-size="15" text-anchor="middle">
                    + {{ neighbour.count * 100 | number : '1.2-2' }}%
                  </text>

                  <text [attr.x]="neighbour.midX" fill="red" [attr.y]="neighbour.midY + 10"
                        *ngFor="let neighbour of poly.incomingMap" font-size="15" text-anchor="middle">
                    - {{ neighbour.count * 100 | number : '1.2-2'}}%
                  </text>
                </g>
              </g>
            </g>
          </svg>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <app-zone-info [zones]="zones" [from]="fromDate" [to]="toDate" [zoneStatistics]="zoneStatistics"
                 [selectedIndex]="selectedZoneIndex"></app-zone-info>
</div>
